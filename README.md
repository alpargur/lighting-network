# lighting-network
Lighting Network for Audiovisual System

## System Architecture
A computer (master node) will play audio via Ableton Live and send MIDI notes to a network of LED light strip(s) over WiFi.<br>
LED lights are controlled by an Arduino / Rasberry Pi controller(s).

![Lighting Network System Architecture](./assets/img/Lighting-Network-System-Architecture.png)

## Technical Information
- **Audio Source:** <br>
Audio is generated by instruments in Ableton using MIDI notes. Audio is transferred to speaker via a sound interface.

- **MIDI Transfer:** <br>
MIDI note transmission is based on Message Queuing Telemetry Transport (MQTT). <br>
An MQTT server on the master node listens to Ableton Live for MIDI notes and publishes them. <br>
A subscriber on the controller receives the MIDIs and use the data to control the lighting.

- **Lighting Network Control:** <br>
A script is is denoted to control the LED strip. Initial idea is to divide an LED strip by the number of instruments available and assign equal portions of the strip to the instruments. <br>
Various MIDI information (pitch, after touch ...) are used to control the lighting.

- **MQTT Mosquitto Setup:** <br>
The server with Ableton will play as a publisher, whereas the Raspberry Pi will be the subscriber. <br>
The broker must be install and configured at the subscriber's side <br>
MQTT Port will be set to 1884 instead of 1883.<br>

![MQTT Mosquitto Setup](./assets/img/Broker_Setup.png)

- **Switch Configuration:** <br>
The Switch is used for mirroring and analyzing the traffic. <br>
Here, all of the components will be connected to the switch with the same IP Netmask 139.6.19.x .<br>
Port 13 of the Switch will be designated to SPAN Port, and will capture the outgoing traffic from Publisher.<br>

![Switch Config](./assets/img/Switch-Config.png)

## System Components
- Hardware
    - Master node (computer w macOS / Windows)
    - Speakers
    - Sound Interface (preferrably 2 inputs 2 outputs)
    - Controller (Rasberry Pi 4)
    - [Lighting](https://www.berrybase.de/adafruit-neopixel-led-streifen-starter-pack-30-led/meter-weiss-1m?c=2428)
        - LED Strip (WS2812 RGB)
        - Cable pins (red => power / white => ground / blue => data)
        - Power Source

- Software
    - Ableton Live

- Tech Stack
    - Python
    - [Mosquito](https://mosquitto.org/) (open-source MQTT protocol)

## Milestones
1. Build the end-to-end architecture
    - Hardware Setup
    - Network Setup (Implementation of MQTT based communication)
    - End-to-End Testing (MIDI signal is successfully transmitted and LED is successfully lit up)
2. Implementation LED controlling program
3. Scale up the lighting network (optional)
4. Create report
5. Presentation

## Task Distribution
| Task                                   | Assignee        |
|----------------------------------------|-----------------|
| Build the end-to-end architecture      | Alpar, Bach     |
| Implementation LED controlling program | Alpar, Bach     |
| Scale up the lighting network          | Alpar, Bach     |
| Create report                          | Alpar, Bach     |
| Presentation                           | Alpar, Bach     |


# Setup Environment
- Go to the root folder of the project
- Make sure you have the `virtualenv` package =>  `pip show virtualenv`
- If it not install it => `pip install virtualenv`
- Create a virtual environment => `python -m venv venv`
- Activate your environment => `source venv/bin/activate`
- Download the dependencies => `pip install -r requirements.txt`
- Download for project package => `python setup.py develop`

<br>

- To close the virtual environment => `deactivate`
- If you need to install new packages run => `pip install <package_name>==<package_version>`
- And update the **requirements.txt** => `pip freeze > requirements.txt`